# 参考
> [LoRa移植到STM32F051](https://blog.csdn.net/aiqinchao/article/details/79201553)
> [LoRa信道活动检测(CAD)](https://blog.csdn.net/qq_23940143/article/details/89471590)
> [LoRa信道活动检测(CAD)](https://blog.csdn.net/qq_15391889/article/details/81050643)
> [什么物联网场景用LoRa，LoRa的工作模式的详解](http://www.elecfans.com/news/1340917.html)
> [LoRa天线电路设计四大要点](http://www.elecfans.com/tongxin/rf/20170323499606.html)
> [几个学习LoRa的重要网站](https://blog.csdn.net/freemote/article/details/79288798)
> [从0到1搭建LoRa物联网](https://blog.csdn.net/freemote/category_10238104.html)
> [LoRa和LoRaWAN技术概览](https://blog.csdn.net/wzz4420381/article/details/54234277)
> [LoRa及LoRaWAN简介](https://blog.csdn.net/silent123go/article/details/100109149)
> [LoRa开发常见问题](https://blog.csdn.net/freemote/article/details/88035084)
> [解析LoRaWAN的四大优势及适用领域](http://www.elecfans.com/iot/800610.html)
> [物联网LoRa系列-25：LoRa终端--LoRaWAN协议简介与LoRa WAN终端软件选择](https://blog.51cto.com/u_11299290/3186403)
> [LoRaWAN协议(一)--架构解析](https://www.cnblogs.com/answerinthewind/p/6200497.html)

> [SX1262与SX1278、SX1276对比分析以及选型指南](https://baijiahao.baidu.com/s?id=1595514886685395246&wfr=spider&for=pc)
> [新一代ASR6501在发布后对SX1262、SX1278、SX1276有何影响](https://blog.csdn.net/RF_star/article/details/95340792)
> [一图带你了解SX1268、SX1278、SX1262的功耗参数](https://www.sohu.com/a/388197494_814535)
> [关于SX1278、SX1276、SX1262的简单详解资料](https://www.cnblogs.com/dongnengshiji/p/10788643.html)
> [终于找到SX1278替换，SX1262替换方案！ASR6501/6502及6505真的很强大](https://zhuanlan.zhihu.com/p/114798245)

> [SX1278芯片LoRa通信官方驱动源码详细讲解](http://www.openedv.com/forum.php?mod=viewthread&tid=300844)
> [LoRa芯片SX1278官方驱动移植](https://blog.csdn.net/qq_37283994/article/details/105849037)
> [SX1268驱动程序设计](http://bbs.ntpcb.com/simple/?t161343.html)
> [【LoRa】SX1268的驱动实例，数据收发控制](https://blog.csdn.net/mr4519/article/details/108517198)
> [LoRa终端节点开发之旅④ - - LoRa驱动_PingPong代码分析](https://blog.csdn.net/qq_23940143/article/details/91659142)

> [LORAWAN在嵌入式系统中的实现--节点端(三)--LORAWAN 终端移植调试(1)](https://blog.csdn.net/gaojn/article/details/77197429)
> [LoRa节点开发：1、初识SDK](https://blog.csdn.net/freemote/article/details/102903955)
> [LoRa节点开发：4、代码详解 LoRaWAN节点入网](https://blog.csdn.net/freemote/article/details/103143285)
> [Windows下使用VS Code编译和构建LoRaWan开源代码](https://blog.csdn.net/luxun12222/article/details/80756354)
> [LoRa开发|LoRaWAN节点(node)代码解析（STM32L051+SX1276/8）安信可RHF76-052](https://blog.csdn.net/ziqi5543/article/details/104176345)

> [STM32移植lorawan协议栈连接腾讯云物联网开发平台（IoT Explorer）](https://blog.csdn.net/lintonxie/article/details/105038547)
> [【树莓派】简易LoRa网关搭建+服务器设置一条龙教程(the things network)](https://blog.csdn.net/accelerateur/article/details/108996031)
> [花一个小时，打造自己的LoRaWAN网关](https://blog.csdn.net/jiangjunjie_2005/article/details/79758720)
> [The Things Network LoRaWAN Stack V3 学习笔记 2.4 使用 Packet Forward 让 LoRaWAN 网关接入](https://blog.csdn.net/iotisan/article/details/88858869)
> [使用免费LoRaWAN服务器www.thethingsnetwork.org](https://blog.csdn.net/freemote/article/details/90315395)
> [从LoRaWAN服务器thethingsnetwork.org获取应用数据](https://blog.csdn.net/freemote/article/details/106361732)
> [LoRaWAN实战 中国470频段的代码实现](https://blog.csdn.net/iotisan/article/details/62885694)
> [STM32节点移植lorawan协议连接腾讯云物联网开发平台（IoT Explorer）](https://blog.csdn.net/lintonxie/article/details/105038547)
> [用树莓派+lora shield搭建一个LoRaWAN网关](https://blog.csdn.net/ljm1995/article/details/109646823)
> [构建一个树莓派供电的LoRaWAN网关](https://www.rs-online.com/designspark/building-a-raspberry-pi-powered-lorawan-gateway-cn)
> [如何将树莓派网关连接到内置LoRaWAN Network Server](http://www.doc88.com/p-16216962418747.html)
> [RAK831 Lite：基于树莓派3的LoRa网关](https://www.21ic.com/evm/news/201806/773688.htm)

> [商密算法SM2、SM3、SM4的用途和原理](https://www.cnblogs.com/wangpin336/p/11049536.html)
> [C语言实现SM4加解密](https://blog.csdn.net/jiujiederoushan/article/details/100122773)
> [SM4 CBC模式加密的C语言实现](https://blog.csdn.net/sy3311193/article/details/73605196)

# LoRa
什么物联网场景用LoRa？在偏远地区，如果没有NB-IoT信号，那么就更适合用LORA了。例如高原地区的牛羊定位管理，养牦牛的或者是养跑山猪的。或者是物联网设备很密集的地方，LORA也会比NB更便宜。例如智慧小区、智慧园区等等。LoRa为什么功耗低？LoRa之所以功耗比NB-IoT低，是因为极少发射数据。就像两个人相距100米站着，你对别人喊话的时候要扯着嗓子吼，听的时候只需要静静的听，喊话的肯定比听话的累多了。

无线网络传输也一样，发送数据的时候比接收数据的时候功耗大的多。例如LoRa发射的工作电流超过100mA，接收的工作电流仅10mA。这里讲的发射和和接收，不只是数据的上行和下行，还包括了“心跳包”内部的上行和下行。NB就像两个人对话：一人说“告诉你一件事情，xxx”，另一人回答“好的，我听到了”。双方都在说话（发射数据）。而LoRa就像两个人约定好时间，一人说“告诉你一件事情，xxx”，另一人只听，但不吭声。
NB-IoT和2G4G一样，是设备端主动去询问基站，问“我在线，你有没有需要发给我的数据？”这个过程中就需要设备端发射数据出去。而LoRa不需要这一步，LoRa会和基站约定一个时间窗口，时间一到，基站只管说，终端只管听。这就是LoRa功耗低的核心原因。双方都约定“10分钟后”开始沟通，双方各自的手表准不准，就很关键了。于是LoRa终端和基站需要定期“对时间”，（通过beacon）。基站“讲话”了，终端有没有“听到”？如果基站需要知道终端有没有收到下行信息，就需要终端上行一个反馈信息。这些技术细节网上资料很多，就不赘述了。
LoRa的三个工作模式

LoRa的工作模式和NB-IoT类似。LoRaClass-A，等同于NB-IoTPSM模式。物联网终端要主动发消息给基站，基站才能找得到终端，并且下发控制指令。
Class-A终端发数据的时候才能接收

LoRaClass-B，等同于NB-IoT的eDRX模式。物联网终端隔一小段时间联系一次基站，此时基站才能找得到终端，并下发控制指令。

Class-B终端定期接收（一般是几十秒一次）

LoRaClass-C，等同于NB-IoT的DRX模式或socket长连接。物联网终端和基站之间一直保持紧密联系，基站随时都能给终端下发控制指令。
Class-C终端随时都可以接收，功耗大

根据应用场景选择LoRa工作模式：

不需要实时控制终端设备的，选择Class-A。省电，一节电池能用几年。例如智能水表、气表、智能井盖、智能垃圾箱等

需要实时控制终端设备的，且延迟几十秒也无所谓的，选择Class-B。省电和控制取个均衡。一节电池也能用半年。例如路灯控制、牛羊定位器、农林大棚控制等。需要实时控制终端设备，且对延迟要求比较高的，选择Class-C，老老实实接电源吧。话说这种情况也不是LoRa的主打应用场景，用的很少。

如何快速搭建LoRa物联网系统？LoRaWan现在已经很成熟了，从传输模块到基站到LoRa云服务一整套可以打包获取。开发者只需要用MCU挂载LoRa传输模块，就可以通过LoRa云服务器收取MCU的上行数据、下发控制指令。和NB-IoT几乎一模一样：MCU挂载NB模块，从运营商的服务器收取MCU的上行数据、下发控制指令。两者的区别：LoRa需要自己买基站、NB需要自己去买sim卡。

如果是空中OTAA激活，则需要准备 DevEUI，AppEUI，AppKey 这三个参数，即设备自身MAC地址和要使用的应用(应用ID和密钥)。
如果是ABP激活，则直接配置 DevAddr，NwkSKey，AppSKey 这三个LoRaWAN最终通讯的参数，不再需要join流程。在这种情况下，这个设备是可以直接发应用数据的。

# LoRa节点方案
## Semtech SX1262
LoRa Core™ Long Range Low Power LoRa® Transceiver +22dBm, global frequency coverage
SX1261, SX1262 and SX1268 sub-GHz radio transceivers are ideal for long range wireless applications. Both devices are designed for long battery life with just 4.2 mA of active receive current consumption. The SX1261 can transmit up to +15dBm and the SX1262 and SX1268 can transmit up to +22dBm with highly efficient integrated power amplifiers.
These devices support LoRa® modulation for LPWAN use cases and (G)FSK modulation for legacy use cases. The devices are highly configurable to meet different application requirements utilizing the global LoRaWAN® standard or proprietary protocols.
The devices are designed to comply with the physical layer requirements of the LoRaWAN specification released by the LoRa Alliance®.
The radio is suitable for systems targeting compliance with radio regulations including but not limited to ETSI EN 300 220, FCC CFR 47 Part 15, China regulatory requirements and the Japanese ARIB T-108. Continuous frequency coverage from 150MHz to 960MHz allows the support of all major sub-GHz ISM bands around the world.

## Semtech SX1276
LoRa Core™ 137MHz to 1020MHz Long Range Low Power Transceiver
The SX1276/77/78/79 transceivers feature the LoRa® long range modem that provides ultra-long range spread spectrum communication and high interference immunity whilst minimizing current consumption.
Using Semtech’s patented LoRa modulation technique SX1276/77/78/79 can achieve a sensitivity of over -148dBm using a low cost crystal and bill of materials. The high sensitivity combined with the integrated +20dBm power amplifier yields industry leading link budget making it optimal for any application requiring range or robustness. LoRa also provides significant advantages in both blocking and selectivity over conventional modulation techniques, solving the traditional design compromise between range, interference immunity and energy consumption.

# LoRa网关方案
## Semtech SX1301
LoRa Core™ Digital Baseband Chip for outdoor LoRaWAN® network macro gateways
The SX1301 digital baseband chip is a massive digital signal processing engine specifically designed to offer breakthrough gateway capabilities in the ISM bands worldwide. It integrates the LoRa concentrator IP.

## Semtech SX1302
LoRa Core™ Digital Baseband Chip for LoRaWAN network gateways
The SX1302 is a new generation of baseband LoRa® chip for gateways. It excels in reducing current consumption, simplifies the thermal design of gateways, and reduces the bill Of materials costs, yet it is capable of handling a higher amount of traffic than preceding devices.

# 驱动获取
最新版的驱动在`https://github.com/Lora-net/LoRaMac-node`


# 安全
如果一个数据帧包含一个数据负载，FRMPayload必须在MIC计算之前被加密。加密机制基于IEEE 802.15.4/2006 Annex B[IEEE802154]提到的算法，采用长度为128bits的AES密钥。默认情况下，是LoRaWAN层为所有FPort的数据加密/解密。如果应用层方便的话，也可以在LoRaWAN层的上层对除了FPort为0的数据加解密。至于哪些FPort交给LoRaWAN层之外的层次进行加解密，则需要服务器和节点额外的进行沟通决定。
