# 作者
QQ群：**852283276**
微信：**arm80x86**
微信公众号：**青儿创客基地**
B站：[主页 `https://space.bilibili.com/208826118`](https://space.bilibili.com/208826118)

附件1：技术规格说明
# 网络数据延迟测量系统技术规格说明
## 系统功能及用途
上交所与深交所各自使用行情网关（后续简称为VDE）对外提供流式行情数据，需要接收实时行情的程序采用TCP方式连接VDE的实时数据端口，并按照各交易所要求进行登录。上交所和深交所的VDE均限制同时只接收一条TCP连接，后续的连接会被拒绝。VDE服务按实例进行申请并付费使用。在实际应用中，需要对网络数据进出服务器的时刻和延迟进行精确测量。
## 系统规格参数
### 系统构成
本系统基于FPGA实现以太网数据包的捕获和时间测量，架构如下图所示： 
 
系统直接在FPGA内部实现高效的PHY和MAC处理，并可直接连接FPGA内部处理逻辑和存储器，提高数据处理传输效率，减少外部接口传输时延，实时性更强。
考虑到FPGA内部的数字处理可采用并行方式，可实现多个网口的并发处理。只要FPGA连接的SFP+接口数量充足，就能够实现多路同时捕获和测量。
### 性能指标
A）	捕获数据的时间戳精度达到50ns
在FPGA内部维护一个高精度定时器，通过驱动软件或者IEEE1588协议进行授时（默认第1路SFP+接口支持IEEE1588协议），在授时完成之后，所有SFP+接口均以新的定时器打时间戳，
B）	支持SFP+接口数量不少于4个
支持SFP+接口数量主要受到两方面条件限制：首先FPGA板卡需要具备充足的万兆以太网端口，其次FPGA芯片需要有充裕的逻辑资源用于实现数据包捕获，由于对应每一路都需要在FPGA内实现一路独立的万兆以太网处理逻辑消耗大量逻辑资源，在FPGA芯片逻辑资源一定的前提下只能支持有限个包捕获接口。根据目前能够采购到的FPGA板卡情况，本次实现的行情分发系统最多支持4路。随着FPGA技术的不断进步，大容量多端口的FPGA板卡上市后，可考虑将行情分发系统升级，以支持更多的接口。
## 主要技术要求
### FPGA板卡
具备4个SFP+接口，可支持4路以太网数据同时捕获；
具备PCI express接口，可与服务器通过PCE express接口进行通信；
具备主动散热能力；
用于安装FPGA板卡的服务器主机需具备安装Full height，3/4 Length PCI express接口板卡的空间及供电能力；
工作环境温度：10~30℃；
工作环境湿度：<90%，无冷凝。
### 备用电源
   系统应配备备用电源，以避免因突然断电导致的系统损坏。
## 交付设备及技术资料
### 提交的硬件设备包括以下内容
FPGA板卡；
### 提交的技术资料包括以下内容
硬件使用文档；
软件使用文档；
方案设计文档；
FPGA设计源代码。
## 进度计划
2019.06-2019.07	架构设计
2019.08-2019.09	FPGA逻辑设计与仿真
2019.10-2019.11	系统调试优化
2019.11-2019.12	设备试运行



