# 作者
QQ群：**852283276**
微信：**arm80x86**
微信公众号：**青儿创客基地**
B站：[主页 `https://space.bilibili.com/208826118`](https://space.bilibili.com/208826118)

# 需求
1. 设备管理，组网时可支持控制多台记录仪
2. 显示记录仪文件列表，显示本地文件列表
3. 删除，下载，上传文件，可显示进度和速度
4. 格式化磁盘
5. 记录控制，开始记录、停止记录
6. 兼容触摸屏设计，页面切换支持左右划，顶部设计导航栏，信息以列表形式显示，方便用户上下划动

# 控制软件架构
支持Web和Qt两种UI前端，控制和数据路径分离，
```c
          -------                         ------
          | web |<---------->|<---------->| qt |
          -------            |            ------
          ----------------   |   -------------
          | control path |<->|<->| data path |                            
          ----------------       -------------
                    |                 |
               -----------   ----------------------
               | jsonrpc |   | http/ftp/nfs/samba |            
               -----------   ----------------------
                    |                 |
             <------------------------------>
             |               |              |
       --------------  -------------    ----------
       | http/https |  | websocket |    | socket |
       --------------  -------------    ----------
             |               |               |
             |<----------------------------->|                                      
             |                               |                      
------------------------------------------------------------------
|       | nginx  | <-> | fcgi/socket | <-> |  user app  |        |
|----------------------------------------------------------------|
|                linux/windows                | vxworks/freertos |
|----------------------------------------------------------------|
|                        x86/arm/powerpc                         |
------------------------------------------------------------------
```
项目中会有多种部署形态，考虑网络中同时部署下面三种形态的设备，
 - A：带显示的记录仪（触摸屏，或者带显示接口/显卡的嵌入式计算机，通常运行Linux操作系统）
 - B：不带显示的记录仪
 - C：仅运行UI界面的其他设备（该设备运行的可以是Windows，也可以是Linux，甚至国产操作系统麒麟等等）

这时，如果把一个设备的文件备份到另一个设备，同时每个UI均可监控网络内的所有设备，不同的形态下的界面和user app功能是不一样的，比如C类设备的user app只需完成文件部分功能，A类设备的user app还有自身健康管理等功能。我们完全可以把C类设备的user app和qt界面编译到一起，但这样必然是不好的，对吧。

# 界面设计
## 首页设计
设计一个六宫格的导航功能区，位于屏幕的中央，
```c
------------------------------------------------
|            |                |                |
|  设备管理  |  设备文件管理  |  本地文件管理  |
|            |                |                |
|----------------------------------------------|
|            |                |                |
|    帮助    |                |                |
|            |                |                |
------------------------------------------------
```
## 顶部导航设计
前进，后退，回到首页
## 设备管理
- 显示设备列表，在设备列表中选择需要操作的设备，需要完成功能有：
- 自检
- 软件升级与回滚，显示升级历史记录
- 产品信息（序列号等）显示
- 板卡健康信息（电压/电流/功耗/温度等）显示
- 设备控制（重启等）
- 格式化/安全擦除
## 设备/本地文件管理
```c
-----------------------------------------------
|  文件夹操作功能区  |     文件操作功能区     |
|--------------------|-------------------------
|                    |                        |
|                    |        文件列表        |
|                    |                        |
|     文件夹列表     |-------------------------
|                    |                        |
|                    |      文件操作记录      |
|                    |                        |
-----------------------------------------------
```
本地可能是一个PC机，也可能是我们的带液晶屏的嵌入式设备，
- 文件夹操作功能区（删除/恢复/下载/上传）
- 文件操作功能区（删除/恢复/下载/上传）
- 设备控制（开始记录/停止记录/板卡相关控制如配置ADC分辨率等），不同设备的控制功能不一样，做成可扩展架构，通过查询设备来获知控制功能，从而决定界面
- 附加功能：本地数据校验，根据协议的帧格式，对数据进行校验，校验程序通过加帧配置文件支持不同数据类型的校验
  | 帧头（固定）|帧标志1（递增）|帧标志2（递减）|......|......|帧尾（固定/CRC/SUM）|
- 附加功能：本地数据预览，对视频/音频数据进行预览，RAW数据可显示其波形
- 附加功能：加密/解密/备份
## 帮助
使用帮助，软件版本信息
